<!DOCTYPE html>
<html>
<head>
      <meta charset="utf-8" />
</head>
<body style="background-color:#EEEEEE">
<form name="counter">
    <br>
    <table>
        <tr>
            <td colspan="3">
                <select name="charSelect">
                <? for (const charName of index.keys()) { ?>
                    <? if (charName !== "Summary") { ?>
                        <option value="<?=charName?>"><?=charName?></option>
                    <? } ?>
                <? } ?>
    </select>
            </td>
        </tr>
        <tr>
            <td>
                <input type="button" value="Доб. счётчик" onclick="addCounter(document.counter.charSelect.value)" />
            </td>
            <td><input type="text" id="effect" value="Эффект" size="10" /></td>
            <td><input type="number" id="count" value="10" size="5" /></td>
        </tr>
        <tr>
            <td><input type="button" value="Доб. таймер" style="width:100%" /></td>
            <td><input type="text" name="timeEffect" value="Эффект" size="10" /></td>
        </tr>
    </table>
    <br>
    <input type="button" name="stepAllB" value="Шаг счётчиков" onclick="stepAll()" />
</form>
<script>
      console.log("start script");
      index = new Map();
      <? for (const charName of index.keys()) { ?>
            index.set(<?= charName ?>, <?= index.get(charName) ?>);
            <? } ?>
      console.log(index);
      function addCounter(name) {
            console.log(index);
            google.script.run.addCounterPair(
                    name, index.get(name), index.get("Summary"),
                    document.getElementById("effect").value,
                    document.getElementById("count").value);
      }
      function addTimer() {
            google.script.run.addTimer(document.counter.timeName.value);
      }
      function stepAll() {
            console.log(Array.from(index.values()));
            document.counter.stepAllB.disabled = true;
            google.script.run
                    .withSuccessHandler(function(r){
                          document.counter.stepAllB.disabled = false;
                    })
                    .stepAll(Array.from(index.values()));
      }

      //document.counter.addCounterB.addEventListener("click", addCounter);
      //document.counter.addTimerB.addEventListener("click", addTimer);
      //document.counter.stepAllB.addEventListener("click", stepAll);
</script>
</body>
</html>